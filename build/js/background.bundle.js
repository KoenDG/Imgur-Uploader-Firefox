(()=>{var e={171:e=>{"use strict";e.exports.setCopy=function(e){var o="clipboard-textarea-hidden-id",r=document.getElementById(o);if(r)console.log("The textarea already exists :3");else{console.log("Creating textarea");var t=document.createElement("textarea");t.id=o,t.style.position="fixed",t.style.top=-100,t.style.left=-100,t.style.width="1px",t.style.height="1px",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",document.querySelector("body").appendChild(t),r=document.getElementById(o)}console.log(r),r.value=e,r.select();try{document.execCommand("copy")?console.log("The text is now on the clipboard"):console.error("Cannot copy text")}catch(e){console.log("Unable to copy.")}}},546:(e,o,r)=>{"use strict";var t=function(){function e(e,o){for(var r=0;r<o.length;r++){var t=o[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(o,r,t){return r&&e(o.prototype,r),t&&e(o,t),o}}(),n=r(770);e.exports=function(){function e(){var o=this;!function(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this,e),browser.storage.local.get("firefox-uploader-client-id").then((function(e){var r=["a6bebdd6a51f656","f752792c52f4cdf","474d8a50e7e752d","9089d7837e30269","6c6fa522da181b8","bbf63f907ae5614","480391db79e87b6","ea76f402e22007a"];void 0!==e["firefox-uploader-client-id"]?(o.clientID=e["firefox-uploader-client-id"],console.log(e["firefox-uploader-client-id"])):o.clientID=r[Math.floor(Math.random()*r.length)],console.log(o.clientID)}))}return t(e,[{key:"update",value:function(){var e=this;browser.storage.local.get("firefox-uploader-client-id").then((function(o){var r=["a6bebdd6a51f656","f752792c52f4cdf","474d8a50e7e752d","9089d7837e30269","6c6fa522da181b8","bbf63f907ae5614","480391db79e87b6","ea76f402e22007a"];void 0!==o["firefox-uploader-client-id"]?(e.clientID=o["firefox-uploader-client-id"],console.log(o["firefox-uploader-client-id"])):e.clientID=r[Math.floor(Math.random()*r.length)],console.log(e.clientID)}))}},{key:"uuid",value:function(){var e=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(o){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===o?r:3&r|8).toString(16)}))}},{key:"imageReader",value:function(e){var o=this,r=new FileReader;return new Promise((function(t,n){r.onload=function(e){t(e.target.result.split("base64,")[1])},r.onerror=function(){return n(o)},r.readAsDataURL(e)}))}},{key:"uploadToImgur",value:function(e){var o=this,r=this;return new Promise((function(t,a){console.log(o),console.log(r.uuid());var i={url:"https://api.imgur.com/3/image",headers:{authorization:"Client-ID "+r.clientID},json:{image:e}};console.log(i),n.post(i,(function(e,o,r){console.log(r.data),r.data.error?a(r.data):t(r.data)}))}))}},{key:"uploader",value:function(e){return this.imageReader(e).then(this.uploadToImgur.bind(this))}},{key:"remove",value:function(e){var o=this;return new Promise((function(r,t){var a={method:"delete",url:"https://api.imgur.com/3/image/"+e,headers:{authorization:"Client-ID "+o.clientID}};console.log(a),n(a,(function(e,o,n){var a=JSON.parse(n);a.data?r(a):t(a)}))}))}}]),e}()},19:e=>{"use strict";var o=function(){function e(e,o){for(var r=0;r<o.length;r++){var t=o[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(o,r,t){return r&&e(o.prototype,r),t&&e(o,t),o}}();e.exports=function(){function e(){!function(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this,e),browser.storage.local.get("firefox-uploader-imgur").then((function(e){0==Object.getOwnPropertyNames(e).length&&(console.log("test"),browser.storage.local.set({"firefox-uploader-imgur":[]}))}))}return o(e,[{key:"add",value:function(e){return new Promise((function(o,r){browser.storage.local.get("firefox-uploader-imgur").then((function(r){var t=r["firefox-uploader-imgur"];e.viewable=!0,t.push(e),console.log(t),browser.storage.local.set({"firefox-uploader-imgur":t}).then((function(){o("test")}))}))}))}},{key:"remove",value:function(e){browser.storage.local.get("firefox-uploader-imgur").then((function(o){var r=[],t=!0,n=!1,a=void 0;try{for(var i,s=o["firefox-uploader-imgur"][Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var u=i.value;u.id!=e&&r.push(u)}}catch(e){n=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw a}}browser.storage.local.set({"firefox-uploader-imgur":r})}))}},{key:"change",value:function(e,o){!e instanceof Array&&(e=[e]),browser.storage.local.get("firefox-uploader-imgur").then((function(r){var t=[],n=!0,a=!1,i=void 0;try{for(var s,u=r["firefox-uploader-imgur"][Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=s.value;if(e.indexOf(l.id)>=0){for(var c in console.log(e),console.log(o),o)o.hasOwnProperty(c)&&(l[c]=o[c]);console.log(l),t.push(l)}else t.push(l)}}catch(e){a=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}browser.storage.local.set({"firefox-uploader-imgur":t})}))}},{key:"removeAll",value:function(){browser.storage.local.set({"firefox-uploader-imgur":[]})}}]),e}()},770:function(e,o){var r,t;r=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");o.log={trace:t,debug:t,info:t,warn:t,error:t};function o(a,i){if("function"!=typeof i)throw new Error("Bad callback given: "+i);if(!a)throw new Error("No options given");var s=a.onResponse;if((a="string"==typeof a?{uri:a}:JSON.parse(JSON.stringify(a))).onResponse=s,a.verbose&&(o.log=function(){var e,o,r={},a=["trace","debug","info","warn","error"];for(o=0;o<a.length;o++)r[e=a[o]]=t,"undefined"!=typeof console&&console&&console[e]&&(r[e]=n(console,e));return r}()),a.url&&(a.uri=a.url,delete a.url),!a.uri&&""!==a.uri)throw new Error("options.uri is a required argument");if("string"!=typeof a.uri)throw new Error("options.uri must be a string");for(var u=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],l=0;l<u.length;l++)if(a[u[l]])throw new Error("options."+u[l]+" is not supported");if(a.callback=i,a.method=a.method||"GET",a.headers=a.headers||{},a.body=a.body||null,a.timeout=a.timeout||o.DEFAULT_TIMEOUT,a.headers.host)throw new Error("Options.headers.host is not supported");a.json&&(a.headers.accept=a.headers.accept||"application/json","GET"!==a.method&&(a.headers["content-type"]="application/json"),"boolean"!=typeof a.json?a.body=JSON.stringify(a.json):"string"!=typeof a.body&&(a.body=JSON.stringify(a.body)));var c=function(e){var o=[];for(var r in e)e.hasOwnProperty(r)&&o.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return o.join("&")};if(a.qs){var d="string"==typeof a.qs?a.qs:c(a.qs);-1!==a.uri.indexOf("?")?a.uri=a.uri+"&"+d:a.uri=a.uri+"?"+d}if(a.form){if("string"==typeof a.form)throw"form name unsupported";if("POST"===a.method){var f=(a.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(a.headers["content-type"]=f,f){case"application/x-www-form-urlencoded":a.body=c(a.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=function(e){var o={};o.boundry="-------------------------------"+Math.floor(1e9*Math.random());var r=[];for(var t in e)e.hasOwnProperty(t)&&r.push("--"+o.boundry+'\nContent-Disposition: form-data; name="'+t+'"\n\n'+e[t]+"\n");return r.push("--"+o.boundry+"--"),o.body=r.join(""),o.length=o.body.length,o.type="multipart/form-data; boundary="+o.boundry,o}(a.form);a.body=p.body,a.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+f)}}}return a.onResponse=a.onResponse||t,!0===a.onResponse&&(a.onResponse=i,a.callback=t),!a.headers.authorization&&a.auth&&(a.headers.authorization="Basic "+function(e){var o,r,t,n,a,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,u=0,l="",c=[];if(!e)return e;do{o=(a=e.charCodeAt(s++)<<16|e.charCodeAt(s++)<<8|e.charCodeAt(s++))>>18&63,r=a>>12&63,t=a>>6&63,n=63&a,c[u++]=i.charAt(o)+i.charAt(r)+i.charAt(t)+i.charAt(n)}while(s<e.length);switch(l=c.join(""),e.length%3){case 1:l=l.slice(0,-2)+"==";break;case 2:l=l.slice(0,-1)+"="}return l}(a.auth.username+":"+a.auth.password)),function(t){var n=new e,a=!1,i=function(e){var o,r=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{o=location.href}catch(e){(o=document.createElement("a")).href="",o=o.href}var t=r.exec(o.toLowerCase())||[],n=r.exec(e.toLowerCase());return!(!n||n[1]==t[1]&&n[2]==t[2]&&(n[3]||("http:"===n[1]?80:443))==(t[3]||("http:"===t[1]?80:443)))}(t.uri),s="withCredentials"in n;if(r+=1,n.seq_id=r,n.id=r+": "+t.method+" "+t.uri,n._id=n.id,i&&!s){var u=new Error("Browser does not support cross-origin request: "+t.uri);return u.cors="unsupported",t.callback(u,n)}function l(){a=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=t.timeout,o.log.error("Timeout",{id:n._id,milliseconds:t.timeout}),t.callback(e,n)}n.timeoutTimer=setTimeout(l,t.timeout);var c={response:!1,loading:!1,end:!1};return n.onreadystatechange=d,n.open(t.method,t.uri,!0),i&&(n.withCredentials=!!t.withCredentials),n.send(t.body),n;function d(r){if(a)return o.log.debug("Ignoring timed out state change",{state:n.readyState,id:n.id});if(o.log.debug("State change",{state:n.readyState,id:n.id,timed_out:a}),n.readyState===e.OPENED)for(var i in o.log.debug("Request started",{id:n.id}),t.headers)n.setRequestHeader(i,t.headers[i]);else n.readyState===e.HEADERS_RECEIVED?f():n.readyState===e.LOADING?(f(),p()):n.readyState===e.DONE&&(f(),p(),g())}function f(){if(!c.response){if(c.response=!0,o.log.debug("Got response",{id:n.id,status:n.status}),clearTimeout(n.timeoutTimer),n.statusCode=n.status,i&&0==n.statusCode){var e=new Error("CORS request rejected: "+t.uri);return e.cors="rejected",c.loading=!0,c.end=!0,t.callback(e,n)}t.onResponse(null,n)}}function p(){c.loading||(c.loading=!0,o.log.debug("Response body loading",{id:n.id}))}function g(){if(!c.end){if(c.end=!0,o.log.debug("Request done",{id:n.id}),n.body=n.responseText,t.json)try{n.body=JSON.parse(n.responseText)}catch(e){return t.callback(e,n)}t.callback(null,n,n.body)}}}(a)}var r=0;function t(){}function n(e,o){return function(r,t){return"object"==typeof t&&(r+=" "+JSON.stringify(t)),e[o].call(e,r)}}return o.withCredentials=!1,o.DEFAULT_TIMEOUT=18e4,o.defaults=function(e,r){var t=function(o){return function(r,t){for(var n in r="string"==typeof r?{uri:r}:JSON.parse(JSON.stringify(r)),e)void 0===r[n]&&(r[n]=e[n]);return o(r,t)}},n=t(o);return n.get=t(o.get),n.post=t(o.post),n.put=t(o.put),n.head=t(o.head),n},["get","put","post","head"].forEach((function(e){var r=e.toUpperCase();o[e.toLowerCase()]=function(e){"string"==typeof e?e={method:r,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=r;var t=[e].concat(Array.prototype.slice.apply(arguments,[1]));return o.apply(this,t)}})),o.couch=function(e,r){return"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,r=r||t,o(e,(function(e,o,t){if(e)return r(e,o,t);if((o.statusCode<200||o.statusCode>299)&&t.error){for(var n in e=new Error("CouchDB error: "+(t.error.reason||t.error.error)),t)e[n]=t[n];return r(e,o,t)}return r(e,o,t)}))},o},void 0===(t=r.apply(o,[]))||(e.exports=t)}},o={};function r(t){var n=o[t];if(void 0!==n)return n.exports;var a=o[t]={exports:{}};return e[t].call(a.exports,a,a.exports,r),a.exports}(()=>{"use strict";var e=r(546),o=r(19),t=(r(171),new e),n=new o;function a(){browser.notifications.create("Imgur Uploader",{type:"basic",title:"Imgur Uploader",message:"Upload successful!",iconUrl:"../../icons/favicon.png"})}function i(){browser.notifications.create("Imgur Uploader",{type:"basic",title:"Imgur Uploader",message:"Upload Failed",iconUrl:"../../icons/favicon.png"})}browser.browserAction.setIcon({path:"../icons/favicon.png"}),browser.storage.local.get("firefox-uploader-announce").then((function(e){void 0===e["firefox-uploader-announce"]?browser.storage.local.set({"firefox-uploader-announce":{"1.6.1":"true"}}).then((function(){browser.tabs.create({url:"../templates/announce/1.6.1.html"})})):void 0===e["firefox-uploader-announce"]["1.6.1"]&&(e["firefox-uploader-announce"]["1.6.1"]="true",browser.storage.local.set({"firefox-uploader-announce":e["firefox-uploader-announce"]}),browser.tabs.create({url:"../templates/announce/1.6.1.html"}))})),browser.storage.onChanged.addListener((function(e,o){void 0!==e["firefox-uploader-client-id"]&&t.update()})),browser.menus.create({id:"image-select",type:"normal",title:"Upload to Imgur",contexts:["image"],checked:!1},(function(){browser.runtime.lastError?console.log("error creating item:"+browser.runtime.lastError):console.log("item created successfully")})),browser.menus.onClicked.addListener((function(e,o){"image"==e.mediaType&&(console.log(e.srcUrl),console.log(e),console.log(t),e.srcUrl.startsWith("data")?t.uploadToImgur(e.srcUrl.split("base64,")[1]).then((function(e){browser.storage.local.get("firefox-uploader-auto-copy").then((function(o){1==o["firefox-uploader-auto-copy"]&&browser.tabs.query({currentWindow:!0,active:!0}).then((function(o){console.log(o),browser.tabs.sendMessage(o[0].id,{link:e.link})}))})),n.add(e)})).then(a,i):e.srcUrl.startsWith("file")?browser.notifications.create("Imgur Uploader",{type:"basic",title:"Imgur Uploader",message:"Please use 'Add image' to upload local file",iconUrl:"../../icons/favicon.png"}):t.uploadToImgur(e.srcUrl).then((function(e){browser.storage.local.get("firefox-uploader-auto-copy").then((function(o){1==o["firefox-uploader-auto-copy"]&&browser.tabs.query({currentWindow:!0,active:!0}).then((function(o){console.log(o),browser.tabs.sendMessage(o[0].id,{link:e.link})}))})),n.add(e)})).then(a,i))})),browser.runtime.onMessage.addListener((function(e,o,r){"upload"==e.task?e.file?(r({success:!0}),t.uploader(e.file).then((function(e){console.log(e),browser.storage.local.get("firefox-uploader-auto-copy").then((function(o){1==o["firefox-uploader-auto-copy"]&&browser.tabs.query({active:!0}).then((function(o){console.log(o),browser.tabs.sendMessage(o[0].id,{link:e.link})}))})),n.add(e)})).then(a,i)):e.url&&(r({success:!0}),t.uploadToImgur(e.url.split("base64,")[1]).then((function(e){console.log(e),n.add(e),browser.storage.local.get("firefox-uploader-auto-copy").then((function(o){console.log("storing"),1==o["firefox-uploader-auto-copy"]&&browser.tabs.query({active:!0}).then((function(o){console.log(o),browser.tabs.sendMessage(o[0].id,{link:e.link})}))}))})).then(a,i)):"auth"==e.task&&(console.log(e),browser.storage.local.set({"firefox-uploader-auth":e}).then((function(){r({response:"auth set"})})))}))})()})();
//# sourceMappingURL=background.bundle.js.map